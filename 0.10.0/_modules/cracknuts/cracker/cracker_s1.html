

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cracknuts.cracker.cracker_s1 &mdash; CrackNuts API Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=e7876aea"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CrackNuts
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cracker.html">Cracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acquisition.html">Acquisition</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CrackNuts</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cracknuts.cracker.cracker_s1</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cracknuts.cracker.cracker_s1</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2024 CrackNuts. All rights reserved.</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="kn">from</span> <span class="nn">cracknuts.cracker</span> <span class="kn">import</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">serial</span>
<span class="kn">from</span> <span class="nn">cracknuts.cracker.cracker_basic</span> <span class="kn">import</span> <span class="n">ConfigBasic</span><span class="p">,</span> <span class="n">CrackerBasic</span><span class="p">,</span> <span class="n">connection_status_check</span>


<div class="viewcode-block" id="ConfigS1">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.ConfigS1">[docs]</a>
<span class="k">class</span> <span class="nc">ConfigS1</span><span class="p">(</span><span class="n">ConfigBasic</span><span class="p">):</span>
<div class="viewcode-block" id="ConfigS1.__init__">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.ConfigS1.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_voltage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_clock_enable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_clock</span> <span class="o">=</span> <span class="mi">8000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_uart_enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_uart_baudrate</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Baudrate</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Baudrate</span><span class="o">.</span><span class="n">BAUDRATE_115200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_uart_bytesize</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Bytesize</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Bytesize</span><span class="o">.</span><span class="n">EIGHTBITS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_uart_parity</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Parity</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Parity</span><span class="o">.</span><span class="n">PARITY_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_uart_stopbits</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Stopbits</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Stopbits</span><span class="o">.</span><span class="n">STOPBITS_ONE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10_000.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_cpol</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpol</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpol</span><span class="o">.</span><span class="n">SPI_CPOL_LOW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_cpha</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpha</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpha</span><span class="o">.</span><span class="n">SPI_CPHA_LOW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_csn_auto</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_spi_csn_delay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_i2c_enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_i2c_dev_addr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mh">0x00</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nut_i2c_speed</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">I2cSpeed</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">I2cSpeed</span><span class="o">.</span><span class="n">STANDARD_100K</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>



<div class="viewcode-block" id="CrackerS1">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1">[docs]</a>
<span class="k">class</span> <span class="nc">CrackerS1</span><span class="p">(</span><span class="n">CrackerBasic</span><span class="p">[</span><span class="n">ConfigS1</span><span class="p">]):</span>
<div class="viewcode-block" id="CrackerS1.get_default_config">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.get_default_config">[docs]</a>
    <span class="k">def</span> <span class="nf">get_default_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigS1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ConfigS1</span><span class="p">()</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">get_current_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigS1</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">GET_CONFIG</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="c1"># === Since the device does not support the channel enable function,</span>
            <span class="c1"># the information is temporarily saved to the host software. ===</span>
            <span class="c1"># return self._parse_config_bytes(res)</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_config_bytes</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_0_enable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel_enable</span><span class="o">.</span><span class="n">osc_channel_0_enable</span>
            <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_1_enable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel_enable</span><span class="o">.</span><span class="n">osc_channel_1_enable</span>
            <span class="c1"># Cracker only supports sampling length in multiples of 1024,</span>
            <span class="c1"># record actual length to truncate waveform data later.</span>
            <span class="n">config</span><span class="o">.</span><span class="n">osc_sample_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_osc_sample_length</span>
            <span class="k">return</span> <span class="n">config</span>
            <span class="c1"># === end ===</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Get config from cracker error, return code 0x</span><span class="si">{</span><span class="n">status</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_config_from_cracker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_config</span><span class="p">()</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_config_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigS1</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">bytes_format</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nut_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_voltage&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_clock_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_clock&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_sample_clock&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_sample_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_sample_length&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_sample_delay&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_channel_0_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_channel_0_gain&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_channel_1_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_channel_1_gain&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_trigger_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_trigger_source&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_trigger_edge&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;osc_trigger_edge_level&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_i2c_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_i2c_dev_addr&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_i2c_speed&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_uart_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_uart_stopbits&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_uart_parity&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_uart_bytesize&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_uart_baudrate&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_enable&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_speed&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_cpol&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_cpha&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_csn_auto&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nut_spi_csn_delay&quot;</span><span class="p">:</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigS1</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_tuple</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bytes_format</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">config_bytes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Parse config bytes error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2">, origin bytes is: [</span><span class="si">{</span><span class="n">config_bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">], &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Default configuration will be used.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">config</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bytes_format</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">config_tuple</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parse config bytes error: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is not a valid config key.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">default_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;nut_voltage&quot;</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="mi">1000</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;nut_spi_speed&quot;</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">100e6</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">default_value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">write_config_to_cracker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ConfigS1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_osc_set_analog_all_channel_enable</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_0_enable</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_1_enable</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_analog_gain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_0_gain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_analog_gain</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_1_gain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_sample_length</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_sample_length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_sample_delay</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_sample_delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_sample_clock</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_sample_clock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_sample_clock_phase</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_sample_phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_trigger_source</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_trigger_source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_trigger_mode</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_trigger_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_trigger_edge</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_trigger_edge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc_trigger_level</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">osc_trigger_edge_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spi_config</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_speed</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_cpol</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_cpha</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_csn_auto</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_csn_delay</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spi_enable</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_spi_enable</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uart_config</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_baudrate</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_bytesize</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_parity</span><span class="p">,</span>
            <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_stopbits</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uart_enable</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_uart_enable</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i2c_config</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_i2c_dev_addr</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_i2c_speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_enable</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_i2c_enable</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_voltage</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_enable</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_enable</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nut_clock_freq</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_clock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_clock_enable</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nut_clock_enable</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">register_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_address</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read register.</span>

<span class="sd">        :param base_address: Base address of the register.</span>
<span class="sd">        :type base_address: int</span>
<span class="sd">        :param offset: Offset of the register.</span>
<span class="sd">        :type offset: int</span>
<span class="sd">        :return: The device response status and the value read from the register or None if an exception is raised.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;II&quot;</span><span class="p">,</span> <span class="n">base_address</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;register_read payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_READ_REGISTER</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">register_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_address</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write register.</span>

<span class="sd">        :param base_address: Base address of the register.</span>
<span class="sd">        :type base_address: int</span>
<span class="sd">        :param offset: Offset of the register.</span>
<span class="sd">        :type offset: int</span>
<span class="sd">        :param data: Data to write.</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0X&quot;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;II&quot;</span><span class="p">,</span> <span class="n">base_address</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;register_write payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_WRITE_REGISTER</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="CrackerS1.osc_analog_enable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.osc_analog_enable">[docs]</a>
    <span class="k">def</span> <span class="nf">osc_analog_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable osc analog.</span>

<span class="sd">        :param channel: Channel to enable, it can be &#39;A&#39; or &#39;B&#39;, or 0, 1</span>
<span class="sd">        :type channel: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_osc_set_analog_channel_enable</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.osc_analog_disable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.osc_analog_disable">[docs]</a>
    <span class="k">def</span> <span class="nf">osc_analog_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable osc analog.</span>

<span class="sd">        :param channel: Channel to enable, it can be &#39;A&#39; or &#39;B&#39;, or 0, 1</span>
<span class="sd">        :type channel: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_osc_set_analog_channel_enable</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_osc_set_analog_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set analog channel enable.</span>

<span class="sd">        :param channel: Channel to enable, it can be &#39;A&#39; or &#39;B&#39;, or 0, 1</span>
<span class="sd">        :type channel: int | str</span>
<span class="sd">        :param enable: Enable or disable.</span>
<span class="sd">        :type enable: bool</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># === Since the device does not support the channel enable function,</span>
        <span class="c1"># the information is temporarily saved to the host software. ===</span>
        <span class="c1"># config = self.get_current_config()</span>
        <span class="c1"># === end ===</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel_enable</span>

        <span class="n">channels</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Channel error, it should in &#39;A&#39; or &#39;B&#39;&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Channel error, it should in 0 or 1&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">final_enable</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">enable</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_1_enable</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">final_enable</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_0_enable</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">enable</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_enable</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_0_enable</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">osc_channel_1_enable</span><span class="p">}</span>
        <span class="c1"># === Since the device does not support the channel enable function,</span>
        <span class="c1"># the information is temporarily saved to the host software. ===</span>
        <span class="c1"># status, res = self._osc_set_analog_all_channel_enable(final_enable)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel_enable</span><span class="o">.</span><span class="n">osc_channel_0_enable</span> <span class="o">=</span> <span class="n">final_enable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel_enable</span><span class="o">.</span><span class="n">osc_channel_1_enable</span> <span class="o">=</span> <span class="n">final_enable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_channel_0_enable</span> <span class="o">=</span> <span class="n">final_enable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_channel_1_enable</span> <span class="o">=</span> <span class="n">final_enable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># === end ===</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_osc_set_analog_all_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_enable</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">final_enable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;B&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_ANALOG_CHANNEL_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_trigger_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set trigger mode.</span>

<span class="sd">        :param mode: Trigger mode. Trigger mode can be one of (&quot;EDGE&quot;, &quot;PATTERN&quot;) or (&quot;E&quot;, &quot;P&quot;),</span>
<span class="sd">                     or the index of the string value.</span>
<span class="sd">        :type mode: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modes1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;EDGE&quot;</span><span class="p">,</span> <span class="s2">&quot;PATTERN&quot;</span><span class="p">)</span>
        <span class="n">modes2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes1</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">modes1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes2</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">modes2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode must be one of </span><span class="si">{</span><span class="n">modes1</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">modes2</span><span class="si">}</span><span class="s2"> if specified as a string.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown trigger mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">, it must be one of (0, 1)&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;B&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_trigger_mode payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_TRIGGER_MODE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_trigger_mode</span> <span class="o">=</span> <span class="n">mode</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set trigger source.</span>

<span class="sd">        :param source: Trigger source: It can be one of (&#39;N&#39;, &#39;A&#39;, &#39;B&#39;, &#39;P&#39;) or (&#39;Nut&#39;&#39;ChA&#39;&#39;ChB&#39;&#39;Protocol&#39;)</span>
<span class="sd">                       or a number in 0, 1, 2, 3, represent Nut, Channel A, Channel B, and Protocol, respectively.</span>
<span class="sd">        :type source: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sources1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
        <span class="n">sources2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;NUT&quot;</span><span class="p">,</span> <span class="s2">&quot;CHA&quot;</span><span class="p">,</span> <span class="s2">&quot;CHB&quot;</span><span class="p">,</span> <span class="s2">&quot;PROTOCOL&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources1</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">sources1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources2</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">sources2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid trigger source: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">. it must be one of </span><span class="si">{</span><span class="n">sources1</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">sources2</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;if specified as a string.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid trigger source, it must be one of (0, 1, 2, 3)&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;B&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_trigger_source payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_ANALOG_TRIGGER_SOURCE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_trigger_source</span> <span class="o">=</span> <span class="n">source</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_trigger_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set trigger edge.</span>

<span class="sd">        :param edge: Trigger edge. (&#39;up&#39;, &#39;down&#39;, &#39;either&#39;) or (&#39;u&#39;, &#39;d&#39;, &#39;e&#39;) or 0, 1, 2</span>
<span class="sd">                     represent up, down, either, respectively.</span>
<span class="sd">        :type edge: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edges1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UP&quot;</span><span class="p">,</span> <span class="s2">&quot;DOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;EITHER&quot;</span><span class="p">)</span>
        <span class="n">edges2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges1</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">edges1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges2</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">edges2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid trigger edge: </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">. it must be one of </span><span class="si">{</span><span class="n">edges1</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">edges2</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;if specified as a string.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid trigger edge, it must be one of (0, 1, 2)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;B&quot;</span><span class="p">,</span> <span class="n">edge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_trigger_edge payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_TRIGGER_EDGE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_trigger_edge</span> <span class="o">=</span> <span class="n">edge</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="CrackerS1.osc_trigger_level">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.osc_trigger_level">[docs]</a>
    <span class="k">def</span> <span class="nf">osc_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set trigger edge level.</span>

<span class="sd">        :param edge_level: Edge level.</span>
<span class="sd">        :type edge_level: int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">edge_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_trigger_level payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_TRIGGER_EDGE_LEVEL</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_trigger_edge_level</span> <span class="o">=</span> <span class="n">edge_level</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_sample_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set sample delay.</span>

<span class="sd">        :param delay: Sample delay. It can be a number or a string, if the input is a string,</span>
<span class="sd">                       you can specify the unit, ending with the value,</span>
<span class="sd">                       using either &#39;k&#39; (representing 1024) or &#39;m&#39; (representing 1024^2).</span>
<span class="sd">                       For example, &quot;1k&quot; means 1024 and &quot;2m&quot; means 2097152.</span>
<span class="sd">        :type delay: int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+)([kKmM])?$&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Input format error, it should be a number or a string &quot;</span>
                    <span class="s2">&quot;ending with the value, using either k or m.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;k&quot;</span><span class="p">:</span>
                    <span class="n">delay</span> <span class="o">*=</span> <span class="mi">1024</span>
                <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                    <span class="n">delay</span> <span class="o">*=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown unit: </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_sample_delay payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_SAMPLE_DELAY</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_sample_delay</span> <span class="o">=</span> <span class="n">delay</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_sample_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set sample length.</span>

<span class="sd">        :param length: Sample length. It can be a number or a string, if the input is a string,</span>
<span class="sd">                       you can specify the unit, ending with the value,</span>
<span class="sd">                       using either &#39;k&#39; (representing 1024) or &#39;m&#39; (representing 1024^2).</span>
<span class="sd">                       For example, &quot;1k&quot; means 1024 and &quot;2m&quot; means 2097152.</span>
<span class="sd">        :type length: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+)([kKmM])?$&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Input format error, it should be a number or a string &quot;</span>
                    <span class="s2">&quot;ending with the value, using either k or m.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;k&quot;</span><span class="p">:</span>
                    <span class="n">length</span> <span class="o">*=</span> <span class="mi">1024</span>
                <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                    <span class="n">length</span> <span class="o">*=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown unit: </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="c1"># Cracker only supports sampling length in multiples of 1024,</span>
        <span class="c1"># record actual length to truncate waveform data later.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_osc_sample_length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_sample_length payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_SAMPLE_LENGTH</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_sample_length</span> <span class="o">=</span> <span class="n">length</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_sample_clock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set osc sample rate</span>

<span class="sd">        :param clock: The sample rate in kHz can be one of (65000, 48000, 24000, 12000, 8000)</span>
<span class="sd">                      or a string in (65M, 48M, 24M, 12M, 8M).</span>
<span class="sd">        :type clock: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clock</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;65M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">65000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;48M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">48000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;24M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">24000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;12M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">12000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;8M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">8000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d+$&quot;</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
                    <span class="n">clock</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clock</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;UnSupport osc sample rate, it should in 65M or 48M or 24M or 12M or 8M&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">clock</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">65000</span><span class="p">,</span> <span class="mi">48000</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;UnSupport osc sample clock, it should in (65000, 48000, 24000, 12000, 8000)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">clock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_sample_clock_rate payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_SAMPLE_RATE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_sample_clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_analog_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gain</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set analog gain.</span>

<span class="sd">        :param channel: Analog channel, it can be &#39;A&#39; or &#39;B&#39;, or 0, 1</span>
<span class="sd">        :type channel: int | str</span>
<span class="sd">        :param gain: Analog gain.</span>
<span class="sd">        :type gain: int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Channel error, it should in &#39;A&#39; or &#39;B&#39;&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Channel error, it should in 0 or 1&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">gain</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Gain error, it should in 1 to 50&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;BB&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">gain</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_ANALOG_GAIN</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_channel_0_gain</span> <span class="o">=</span> <span class="n">gain</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_channel_1_gain</span> <span class="o">=</span> <span class="n">gain</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">osc_sample_clock_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set sample phase.</span>

<span class="sd">        :param phase: Sample phase.</span>
<span class="sd">        :type phase: int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;osc_sample_clock_phase payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">OSC_CLOCK_SAMPLE_PHASE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">osc_sample_phase</span> <span class="o">=</span> <span class="n">phase</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="CrackerS1.nut_voltage_disable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.nut_voltage_disable">[docs]</a>
    <span class="k">def</span> <span class="nf">nut_voltage_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the nut voltage.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.nut_voltage_enable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.nut_voltage_enable">[docs]</a>
    <span class="k">def</span> <span class="nf">nut_voltage_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the nut voltage.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_nut_set_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set nut enable.</span>

<span class="sd">        :param enable: Enable or disable. 0 for disable, 1 for enable if specified as a integer.</span>
<span class="sd">        :type enable: int | bool</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">enable</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">enable</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nut_enable payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">NUT_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_enable</span> <span class="o">=</span> <span class="n">enable</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">nut_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set nut voltage.</span>

<span class="sd">        :param voltage: Nut voltage can be a number or a string. If the input is a float,</span>
<span class="sd">                        the voltage will be treated as a V value. If the input is a string,</span>
<span class="sd">                        you can specify the unit, ending with the value, using either mV or V.</span>
<span class="sd">        :type voltage: float | str | int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+(?:\.\d+)?)([mM]?[vV])?$&quot;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Input format error: &quot;</span> <span class="s2">&quot;it should be a number or a string and end with a unit in V or mV.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">voltage</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;v&quot;</span>
            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span>
                <span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="n">voltage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">voltage</span> <span class="o">&gt;</span> <span class="mi">4000</span> <span class="ow">or</span> <span class="n">voltage</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Nut voltage error, it should in 2.0V to 4.0V&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nut_voltage payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">NUT_VOLTAGE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_voltage</span> <span class="o">=</span> <span class="n">voltage</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">nut_clock_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the nut clock.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_clock_enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">nut_clock_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the nut clock.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nut_set_clock_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_nut_set_clock_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nut_set_clock_enable payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">NUT_CLOCK_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_clock_enable</span> <span class="o">=</span> <span class="n">enable</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">nut_clock_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set nut clock.</span>

<span class="sd">        :param clock: The clock of the nut in kHz</span>
<span class="sd">        :type clock: int | str</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clock</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;24M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">24000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;12M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">12000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;8M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">8000</span>
            <span class="k">elif</span> <span class="n">clock</span> <span class="o">==</span> <span class="s2">&quot;4M&quot;</span><span class="p">:</span>
                <span class="n">clock</span> <span class="o">=</span> <span class="mi">4000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown clock type: </span><span class="si">{</span><span class="n">clock</span><span class="si">}</span><span class="s2">, 24M or 12M or 8M or 4M&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_ERROR</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">clock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nut_set_clock payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">NUT_CLOCK</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">nut_timeout_ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set nut timeout.</span>

<span class="sd">        :param timeout: Nut timeout.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nut_timeout_ms payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">NUT_TIMEOUT</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="CrackerS1.spi_enable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_enable">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the SPI</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.spi_disable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_disable">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the SPI</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_spi_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the SPI.</span>

<span class="sd">        :param enable: True for enable, False for disable.</span>
<span class="sd">        :type enable: bool</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_spi_enable payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_SPI_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_enable</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">spi_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the SPI hardware.</span>

<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_spi_reset payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_SPI_RESET</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">spi_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cpol</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpol</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cpha</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">SpiCpha</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">csn_auto</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">csn_delay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Config the SPI.</span>

<span class="sd">        :param speed: SPI speed.</span>
<span class="sd">        :type speed: int</span>
<span class="sd">        :param cpol: Clock polarity.</span>
<span class="sd">        :type cpol: serial.SpiCpol</span>
<span class="sd">        :param cpha: Clock phase.</span>
<span class="sd">        :type cpha: serial.SpiCpha</span>
<span class="sd">        :param csn_auto: In delay mode, does the chip select signal remain low throughout the delay phase?</span>
<span class="sd">                         Deselecting this option means that during the DELAY, the CS (Chip Select) signal is</span>
<span class="sd">                         normally pulled high.</span>
<span class="sd">                         Selecting this option indicates that during the DELAY, the CS signal is fixed at low.</span>
<span class="sd">        :type csn_auto: bool,</span>
<span class="sd">        :param csn_delay: In delay mode, does the chip select signal remain low throughout the delay phase?</span>
<span class="sd">                        True: CS stays low. False: CS behaves normally and goes high.</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cpol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">csn_auto</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_config</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Get config from cracker error.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_speed</span>
            <span class="k">if</span> <span class="n">cpol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cpol</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_cpol</span>
            <span class="k">if</span> <span class="n">cpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cpha</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_spi_cpha</span>

        <span class="c1"># System clock is 100e6</span>
        <span class="c1"># Clock divider is 2</span>
        <span class="c1"># psc max is 65535</span>
        <span class="n">psc</span> <span class="o">=</span> <span class="mf">100e6</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">speed</span>
        <span class="k">if</span> <span class="n">psc</span> <span class="o">&gt;</span> <span class="mi">65535</span> <span class="ow">or</span> <span class="n">psc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Not support speed.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Not support speed </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">psc</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span>
            <span class="n">psc</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">psc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">psc</span> <span class="o">&gt;</span> <span class="mi">65535</span> <span class="ow">or</span> <span class="n">psc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not support  speed </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Not support speed </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">_speed</span> <span class="o">=</span> <span class="n">speed</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">100e6</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">psc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The speed: [</span><span class="si">{</span><span class="n">_speed</span><span class="si">}</span><span class="s2">] cannot calculate an integer Prescaler, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;so the integer value is set to </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2"> and psc is </span><span class="si">{</span><span class="n">psc</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">speed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">100e6</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">psc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HBB??&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">psc</span><span class="p">),</span> <span class="n">cpol</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">cpha</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">csn_auto</span><span class="p">,</span> <span class="n">csn_delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_spi_config payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_SPI_CONFIG</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_speed</span> <span class="o">=</span> <span class="n">speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_cpol</span> <span class="o">=</span> <span class="n">cpol</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_cpha</span> <span class="o">=</span> <span class="n">cpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_csn_auto</span> <span class="o">=</span> <span class="n">csn_auto</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_spi_csn_delay</span> <span class="o">=</span> <span class="n">csn_delay</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_divisors</span><span class="p">(</span><span class="n">clock</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">clock</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input must be a positive integer.&quot;</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">clock</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">divisors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mi">65535</span><span class="p">:</span>
                <span class="n">divisors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">divisors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">divisors</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_spi_transceive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_delay</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Basic interface for sending and receiving data through the SPI protocol.</span>

<span class="sd">        :param tx_data: The data to send.</span>
<span class="sd">        :param is_delay: Whether the transmit delay is enabled.</span>
<span class="sd">        :type is_delay: bool</span>
<span class="sd">        :param delay: The transmit delay in milliseconds, with a minimum effective duration of 10 nanoseconds.</span>
<span class="sd">        :type delay: int</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the SPI device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?IH?&quot;</span><span class="p">,</span> <span class="n">is_delay</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tx_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">+=</span> <span class="n">tx_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_spi_transceive payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_SPI_TRANSCEIVE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receive status code error [</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

<div class="viewcode-block" id="CrackerS1.spi_transmit">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_transmit">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_transmit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send data through the SPI protocol.</span>

<span class="sd">        :param tx_data: The data to send.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the SPI device.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_transceive</span><span class="p">(</span>
            <span class="n">tx_data</span><span class="p">,</span> <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1_000_000_000</span><span class="p">,</span> <span class="n">rx_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CrackerS1.spi_receive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_receive">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive data through the SPI protocol.</span>

<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the SPI device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_transceive</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1_000_000_000</span><span class="p">,</span> <span class="n">rx_count</span><span class="o">=</span><span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.spi_transmit_delay_receive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_transmit_delay_receive">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_transmit_delay_receive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send and receive data with delay through the SPI protocol.</span>

<span class="sd">        :param tx_data: The data to send.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param delay: The transmit delay in milliseconds, with a minimum effective duration of 10 nanoseconds.</span>
<span class="sd">        :type delay: int</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the SPI device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_transceive</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="n">is_delay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">rx_count</span><span class="o">=</span><span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.spi_transceive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.spi_transceive">[docs]</a>
    <span class="k">def</span> <span class="nf">spi_transceive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send and receive data without delay through the SPI protocol.</span>

<span class="sd">        :param tx_data: The data to send.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the SPI device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi_transceive</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rx_count</span><span class="o">=</span><span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.i2c_enable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_enable">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the I2C</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.i2c_disable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_disable">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the I2C</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_i2c_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the I2C.</span>

<span class="sd">        :param enable: True for enable, False for disable.</span>
<span class="sd">        :type enable: bool</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_i2c_enable payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_I2C_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_i2c_enable</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">i2c_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the I2C.</span>

<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_i2c_reset payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_I2C_RESET</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">i2c_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dev_addr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">I2cSpeed</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Config the SPI.</span>

<span class="sd">        :param dev_addr: The address of the device.</span>
<span class="sd">        :type dev_addr: int</span>
<span class="sd">        :param speed: The speed of the device.</span>
<span class="sd">        :type speed: serial.I2cSpeed</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">dev_addr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_config</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Get config from cracker error.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">dev_addr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dev_addr</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_i2c_dev_addr</span>
            <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_i2c_speed</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;BB&quot;</span><span class="p">,</span> <span class="n">dev_addr</span><span class="p">,</span> <span class="n">speed</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_i2c_config payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_I2C_CONFIG</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_i2c_dev_addr</span> <span class="o">=</span> <span class="n">dev_addr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_i2c_speed</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_i2c_transceive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">combined_transfer_count_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">combined_transfer_count_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">transfer_rw</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">transfer_lens</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">is_delay</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Basic API for sending and receiving data through the I2C protocol.</span>

<span class="sd">        :param tx_data: The data to be sent.</span>
<span class="sd">        :type tx_data: bytes | str | None</span>
<span class="sd">        :param combined_transfer_count_1: The first combined transmit transfer count.</span>
<span class="sd">        :type combined_transfer_count_1: int</span>
<span class="sd">        :param combined_transfer_count_2: The second combined transmit transfer count.</span>
<span class="sd">        :type combined_transfer_count_2: int</span>
<span class="sd">        :param transfer_rw: The read/write configuration tuple of the four transfers in the two sets</span>
<span class="sd">                            of Combined Transfer, with a tuple length of 8, where 0 represents write</span>
<span class="sd">                            and 1 represents read.</span>
<span class="sd">        :type transfer_rw: tuple[int, int, int, int, int, int, int, int, int]</span>
<span class="sd">        :param transfer_lens: The transfer length tuple of the four transfers in the two combined transmit sets.</span>
<span class="sd">        :type transfer_lens: tuple[int, int, int, int, int, int, int, int]</span>
<span class="sd">        :param is_delay: Whether the transmit delay is enabled.</span>
<span class="sd">        :type is_delay: bool</span>
<span class="sd">        :param delay: Transmit delay duration, in nanoseconds, with a minimum effective duration of 10 nanoseconds.</span>
<span class="sd">        :type delay: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the I2C device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">combined_transfer_count_1</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal combined combined_transfer_count_1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">combined_transfer_count_2</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal combined combined_transfer_count_2&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transfer_rw</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transfer_rw length must be 8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transfer_lens</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transfer_lens length must be 8&quot;</span><span class="p">)</span>

        <span class="n">transfer_rw_num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transfer_rw</span><span class="p">))</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="s2">&quot;&gt;?I3B8H?&quot;</span><span class="p">,</span>
            <span class="n">is_delay</span><span class="p">,</span>
            <span class="n">delay</span><span class="p">,</span>
            <span class="n">combined_transfer_count_1</span><span class="p">,</span>
            <span class="n">combined_transfer_count_2</span><span class="p">,</span>
            <span class="n">transfer_rw_num</span><span class="p">,</span>
            <span class="o">*</span><span class="n">transfer_lens</span><span class="p">,</span>
            <span class="n">is_trigger</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">tx_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">+=</span> <span class="n">tx_data</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_I2C_TRANSCEIVE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receive status code error [</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

<div class="viewcode-block" id="CrackerS1.i2c_transmit">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_transmit">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_transmit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send data through the I2C protocol.</span>

<span class="sd">        :param tx_data: The data to be sent.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>
        <span class="n">transfer_rw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">transfer_lens</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_data</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_transceive</span><span class="p">(</span>
            <span class="n">tx_data</span><span class="p">,</span>
            <span class="n">combined_transfer_count_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">combined_transfer_count_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">transfer_rw</span><span class="o">=</span><span class="n">transfer_rw</span><span class="p">,</span>
            <span class="n">transfer_lens</span><span class="o">=</span><span class="n">transfer_lens</span><span class="p">,</span>
            <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CrackerS1.i2c_receive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_receive">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive data through the I2C protocol.</span>

<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :return: The device response status and the data received from the I2C device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transfer_rw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transfer_lens</span> <span class="o">=</span> <span class="p">(</span><span class="n">rx_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_transceive</span><span class="p">(</span>
            <span class="n">tx_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">combined_transfer_count_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">combined_transfer_count_2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">transfer_rw</span><span class="o">=</span><span class="n">transfer_rw</span><span class="p">,</span>
            <span class="n">transfer_lens</span><span class="o">=</span><span class="n">transfer_lens</span><span class="p">,</span>
            <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.i2c_transmit_delay_receive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_transmit_delay_receive">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_transmit_delay_receive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send and receive data with delay through the I2C protocol.</span>

<span class="sd">        :param tx_data: The data to be sent.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param delay: Transmit delay duration, in nanoseconds, with a minimum effective duration of 10 nanoseconds.</span>
<span class="sd">        :type delay: int</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the I2C device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>
        <span class="n">transfer_rw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transfer_lens</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_data</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_transceive</span><span class="p">(</span>
            <span class="n">tx_data</span><span class="p">,</span>
            <span class="n">combined_transfer_count_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">combined_transfer_count_2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">transfer_rw</span><span class="o">=</span><span class="n">transfer_rw</span><span class="p">,</span>
            <span class="n">transfer_lens</span><span class="o">=</span><span class="n">transfer_lens</span><span class="p">,</span>
            <span class="n">is_delay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
            <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.i2c_transceive">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.i2c_transceive">[docs]</a>
    <span class="k">def</span> <span class="nf">i2c_transceive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send and receive data without delay through the I2C protocol.</span>

<span class="sd">        :param tx_data: The data to be sent.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :return: The device response status and the data received from the I2C device.</span>
<span class="sd">                 Return None if an exception is caught.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>
        <span class="n">transfer_rw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transfer_lens</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_data</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c_transceive</span><span class="p">(</span>
            <span class="n">tx_data</span><span class="p">,</span>
            <span class="n">combined_transfer_count_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">combined_transfer_count_2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">transfer_rw</span><span class="o">=</span><span class="n">transfer_rw</span><span class="p">,</span>
            <span class="n">transfer_lens</span><span class="o">=</span><span class="n">transfer_lens</span><span class="p">,</span>
            <span class="n">is_delay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">is_trigger</span><span class="o">=</span><span class="n">is_trigger</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.uart_enable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.uart_enable">[docs]</a>
    <span class="k">def</span> <span class="nf">uart_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the UART.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uart_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CrackerS1.uart_disable">
<a class="viewcode-back" href="../../../cracker.html#cracknuts.cracker.cracker_s1.CrackerS1.uart_disable">[docs]</a>
    <span class="k">def</span> <span class="nf">uart_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the UART.</span>

<span class="sd">        :return: The device response status</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uart_enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">_uart_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the uart.</span>

<span class="sd">        :param enable: True for enable, False for disable.</span>
<span class="sd">        :type enable: bool</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;?&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_enable payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_ENABLE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">protocol</span><span class="o">.</span><span class="n">STATUS_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">nut_uart_enable</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">res</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the UART hardware.</span>

<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_reset payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_RESET</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">baudrate</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Baudrate</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bytesize</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Bytesize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parity</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Parity</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stopbits</span><span class="p">:</span> <span class="n">serial</span><span class="o">.</span><span class="n">Stopbits</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Config uart.</span>

<span class="sd">        :param baudrate: The baudrate of the uart.</span>
<span class="sd">        :type baudrate: serial.Baudrate</span>
<span class="sd">        :param bytesize: The bytesize of the uart.</span>
<span class="sd">        :type bytesize: serial.Bytesize</span>
<span class="sd">        :param parity: The parity of the uart.</span>
<span class="sd">        :type parity: serial.Parity</span>
<span class="sd">        :param stopbits: The stopbits of the uart.</span>
<span class="sd">        :type stopbits: serial.Stopbits</span>
<span class="sd">        :return: The device response status.</span>
<span class="sd">        :rtype: tuple[int, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">baudrate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bytesize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">stopbits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_config</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Get config from cracker error.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NON_PROTOCOL_ERROR</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">baudrate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">baudrate</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_baudrate</span>
            <span class="k">if</span> <span class="n">bytesize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bytesize</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_bytesize</span>
            <span class="k">if</span> <span class="n">parity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parity</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_parity</span>
            <span class="k">if</span> <span class="n">stopbits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stopbits</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">nut_uart_stopbits</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;BBBB&quot;</span><span class="p">,</span> <span class="n">stopbits</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">parity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">bytesize</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_config payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_CONFIG</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_transmit_receive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transmit and receive data through the UART protocol.</span>

<span class="sd">        :param tx_data: The data to be sent.</span>
<span class="sd">        :type tx_data: str | bytes</span>
<span class="sd">        :param rx_count: The number of received data bytes.</span>
<span class="sd">        :type rx_count: int</span>
<span class="sd">        :param is_trigger: Whether the transmit trigger is enabled.</span>
<span class="sd">        :type is_trigger: bool</span>
<span class="sd">        :param timeout: Timeout in milliseconds.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :return: The device response status and the data received from the device.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tx_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H?I&quot;</span><span class="p">,</span> <span class="n">rx_count</span><span class="p">,</span> <span class="n">is_trigger</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tx_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">+=</span> <span class="n">tx_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_transmit_receive payload: </span><span class="si">{</span><span class="n">payload</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_TRANSCEIVE</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_receive_fifo_remained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of remaining unread bytes in the UART receive FIFO.</span>

<span class="sd">        :return: The device response status and the number of remaining unread bytes.</span>
<span class="sd">        :rtype: tuple[int, int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_receive_fifo_remained payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_RECEIVE_FIFO_REMAINED</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_receive_fifo_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read all the remaining data from the UART receive FIFO.</span>

<span class="sd">        :return: The device response status and all the remaining unread bytes.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_receive_fifo_dump payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_CRACKER_UART_RECEIVE_FIFO_DUMP</span><span class="p">)</span>

    <span class="nd">@connection_status_check</span>
    <span class="k">def</span> <span class="nf">uart_receive_fifo_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear all the remaining data in the UART receive FIFO.</span>

<span class="sd">        :return: The device response status and all the remaining unread bytes.</span>
<span class="sd">        :rtype: tuple[int, bytes | None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cracker_uart_receive_fifo_dump payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_command</span><span class="p">(</span><span class="n">protocol</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">CRACKER_UART_CRACKER_UART_RECEIVE_CLEAR</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CrackNuts.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>